# Backup & Restore Test Scenario

백업/복원 기능의 데이터 무결성 검증 시나리오

## 테스트 목적

- Export → Import 후 데이터 동일성 확인
- Replace/Merge 모드 정상 동작 확인
- 검증 실패 시 안전한 에러 처리 확인

---

## 준비 사항

1. 개발 서버 실행: `npm run dev`
2. 브라우저에서 http://localhost:3000 접속
3. 테스트 데이터 생성

---

## 테스트 시나리오 1: Export → Replace → 데이터 동일성 확인

### 1단계: 테스트 데이터 생성

1. **/transactions/new** 페이지로 이동
2. 거래 3개 입력:
   - 수입 1개 (급여, 3,000,000원)
   - 지출 2개 (식비 50,000원, 교통비 30,000원)
3. **/budget** 페이지로 이동
4. 예산 2개 설정:
   - 2026-01: 식비 500,000원, 교통비 200,000원
   - 2026-02: 식비 600,000원

### 2단계: Export 백업

1. **/settings** 페이지로 이동
2. "Export 백업 파일 다운로드" 버튼 클릭
3. `qoint-budget-backup-YYYY-MM-DDTHH-MM-SS.json` 파일 다운로드 확인
4. 파일을 텍스트 에디터로 열어 내용 확인:
   ```json
   {
     "version": "1.0.0",
     "exportedAt": "...",
     "transactions": [
       { "id": "...", "type": "income", "amount": 3000000, ... },
       { "id": "...", "type": "expense", "amount": 50000, ... },
       { "id": "...", "type": "expense", "amount": 30000, ... }
     ],
     "budgets": [
       { "month": "2026-01", "categories": { "식비": 500000, "교통비": 200000 }, ... },
       { "month": "2026-02", "categories": { "식비": 600000 }, ... }
     ]
   }
   ```

### 3단계: 데이터 삭제

1. 브라우저 개발자 도구(F12) → Application/저장소 탭
2. Local Storage → http://localhost:3000
3. `budget_tracker_data` 삭제
4. `budget_tracker_budgets` 삭제
5. 페이지 새로고침 → 모든 데이터 사라진 것 확인

### 4단계: Replace 모드로 Import

1. **/settings** 페이지에서 "Replace (전체 덮어쓰기)" 선택
2. 다운로드한 백업 파일 업로드
3. 성공 메시지 확인: "성공적으로 복원되었습니다 (거래: 3, 예산: 2)"
4. 페이지 새로고침 **없이** 데이터가 자동 갱신되는지 확인 (useSyncExternalStore + notifyStorageChange)

### 5단계: 데이터 동일성 검증

1. **/transactions** 페이지 → 거래 3개 확인
2. **/budget** 페이지 → 2026-01, 2026-02 예산 확인
3. 금액/카테고리/날짜 모두 원본과 동일한지 확인

**✅ 예상 결과:** 백업 전과 완전히 동일한 데이터 복원

---

## 테스트 시나리오 2: Merge 모드 동작 확인

### 1단계: 기존 데이터 준비

1. 거래 1개 추가: 지출 (쇼핑, 100,000원)
2. 예산 1개 추가: 2026-03 (쇼핑 300,000원)

### 2단계: Merge 모드로 Import

1. **/settings** 페이지에서 "Merge (병합)" 선택
2. 이전에 다운로드한 백업 파일 업로드
3. 성공 메시지 확인

### 3단계: 병합 결과 확인

1. **/transactions** 페이지 → 거래 **4개** 확인 (기존 1개 + 백업 3개)
2. **/budget** 페이지 → 예산 **3개** 확인 (2026-01, 02, 03)

**✅ 예상 결과:** 기존 데이터 유지 + 백업 데이터 추가

---

## 테스트 시나리오 3: 검증 실패 처리

### 잘못된 JSON 업로드

1. 텍스트 파일 생성: `invalid.json`
   ```json
   { "version": "1.0.0" }
   ```
   (transactions, budgets 필드 누락)
2. **/settings**에서 업로드
3. 에러 메시지 확인: "검증 실패: ..."
4. 기존 데이터가 손상되지 않았는지 확인

### 파싱 불가능한 파일 업로드

1. 일반 텍스트 파일 생성: `test.txt`
   ```
   This is not JSON
   ```
2. 업로드
3. 에러 메시지 확인: "Import 실패: Unexpected token..."
4. 데이터 무결성 확인

**✅ 예상 결과:** 에러 발생 시 기존 데이터 보호

---

## 테스트 시나리오 4: 크로스 디바이스 데이터 이동

### 시뮬레이션

1. 브라우저 A(Chrome)에서 데이터 생성 및 Export
2. 브라우저 B(Firefox 또는 시크릿 모드)에서 Import
3. 데이터 동일성 확인

**✅ 예상 결과:** 다른 브라우저/기기에서도 데이터 완벽 복원

---

## 자동화 테스트 체크리스트

- [ ] Export 버튼 클릭 → JSON 파일 다운로드
- [ ] 다운로드 파일의 JSON 구조 검증 (version, exportedAt, transactions, budgets)
- [ ] Replace 모드: localStorage 완전 덮어쓰기 확인
- [ ] Merge 모드: 기존 데이터 + 새 데이터 병합 확인
- [ ] 동일 ID 거래: Merge 시 덮어쓰기 (최신 데이터 우선)
- [ ] 동일 월 예산: Merge 시 덮어쓰기
- [ ] Import 후 notifyStorageChange 호출 → UI 자동 갱신
- [ ] 잘못된 JSON 업로드 → 검증 에러, 데이터 무손상
- [ ] 파싱 에러 → 명확한 에러 메시지
- [ ] 메시지 3~5초 후 자동 사라짐 확인

---

## 성공 기준

1. **데이터 무결성**: Export → Import 후 100% 동일
2. **자동 갱신**: Import 후 새로고침 없이 화면 갱신
3. **에러 안전성**: 검증 실패 시 기존 데이터 보호
4. **사용성**: 직관적 UI, 명확한 메시지
5. **빌드 통과**: `npm run build` 및 `npm run lint` 0 에러

---

## 알려진 제한사항

- localStorage 용량 제한(보통 5~10MB): 대량 데이터(수천 개 거래) 시 백업 파일 크기 주의
- 브라우저 간 localStorage 공유 불가 → 백업 파일로 수동 이동 필요
- 백업 파일 암호화 미지원 → 민감한 데이터는 파일 보안 주의

---

## 향후 개선 사항

- [ ] 자동 백업 스케줄링 (주 1회)
- [ ] 백업 파일 암호화 (비밀번호 보호)
- [ ] 클라우드 동기화 (Google Drive, Dropbox)
- [ ] 백업 히스토리 관리 (최근 5개 유지)
- [ ] Import 미리보기 (적용 전 변경사항 확인)
